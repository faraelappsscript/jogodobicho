<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRIE UMA IMAGEM DE DIVULGAÇÃO - 77x Brasil</title>
    
    <!-- Carregamento de dependências -->
    <link rel="preload" href="/assets/fonts/inter.css" as="style">
    <link rel="stylesheet" href="/assets/fonts/inter.css">
    <link rel="preload" href="/assets/fonts/jetbrains-mono.css" as="style">
    <link rel="stylesheet" href="/assets/fonts/jetbrains-mono.css">
    <link rel="preload" href="/theme.css" as="style">
    <link rel="stylesheet" href="/theme.css">
    
    <!-- ESTILOS PERSONALIZADOS PARA ESTA PÁGINA -->
    <style>
        /* Estilos específicos da página imagem.html */
        body {
            background-color: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(59, 130, 246, 0.1), transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(139, 92, 246, 0.1), transparent 40%);
        }
        
        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: var(--spacing-md);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
            max-width: 600px;
            margin-bottom: var(--spacing-xl);
            padding-top: var(--spacing-lg);
        }

        .main-title {
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: var(--spacing-md);
            text-align: center;
            font-family: 'Inter', sans-serif;
            background: var(--gradient-accent);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: var(--text-primary);
        }

        .palpites-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            border: 1px solid var(--border-color);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 700px;
        }

        .palpites-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }

        .palpites-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
            border-color: var(--border-accent);
        }

        .card-subtitle {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            font-family: 'Inter', sans-serif;
        }

        .palpite-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            padding: var(--spacing-md);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .palpite-row .select-group-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            background: var(--gradient-primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all var(--transition-normal);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palpite-row .select-group-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .palpite-row .group-info {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: var(--spacing-sm);
        }

        .palpite-row .input-xy-container {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .palpite-row .input-xy {
            display: flex;
            align-items: center;
            gap: 2px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            padding: 2px;
        }

        .palpite-row .input-x, .palpite-row .input-y {
            width: 35px;
            height: 35px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palpite-row .input-x {
            background-color: var(--bg-card);
        }

        .palpite-row .input-y {
            background-color: var(--bg-primary);
            cursor: not-allowed;
            border: none;
            color: var(--accent-success);
        }

        .palpite-row .clear-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all var(--transition-normal);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palpite-row .clear-btn:hover {
            background-color: var(--bg-card-hover);
            border-color: var(--border-accent);
        }

        /* Novos estilos para os botões principais */
        .main-action-buttons {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .main-action-buttons .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-md);
            background: var(--gradient-primary);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            text-decoration: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-action-buttons .btn.secondary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .main-action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }

        /* Estilos para os botões de edição (ocultos por padrão) */
        .edit-action-buttons {
            display: none;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .edit-action-buttons .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-md);
            background: var(--gradient-primary);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            text-decoration: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-action-buttons .btn.secondary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .edit-action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }

        /* Estilos para ocultar/mostrar as linhas de palpite */
        .palpites-rows.hidden {
            display: none;
        }

        /* Modal de seleção de grupo */
        .modal-group-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .modal-group-list li {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .modal-group-list li:last-child {
            border-bottom: none;
        }

        .modal-group-list li:hover {
            background-color: var(--bg-card-hover);
        }

        /* Estilos para a imagem gerada no modal de visualização */
        .generated-image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .generated-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Modal de visualização da imagem - Atualizado para seguir o padrão do index(3).html */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .image-modal-content {
            position: relative;
            background-color: var(--bg-secondary);
            margin: 2vh auto;
            padding: 0;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            height: auto;
            max-height: 96vh;
            box-shadow: var(--shadow-2xl);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }

        .image-modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
        }

        .image-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .image-modal-close {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-modal-close:hover {
            background-color: var(--bg-card-hover);
            color: var(--text-primary);
            border-color: var(--border-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .image-modal-body {
            padding: var(--spacing-lg);
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            min-height: 0;
            background: var(--bg-card);
        }

        .image-modal-body img {
            max-width: 100%;
            max-height: calc(96vh - 160px);
            width: auto;
            height: auto;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            object-fit: contain;
        }

        .image-modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
        }

        .image-modal-footer .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            white-space: nowrap;
            transition: all var(--transition-normal);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            min-width: 140px;
            font-family: 'Inter', sans-serif;
            box-shadow: var(--shadow-lg);
        }

        .image-modal-footer .btn:hover {
            background-color: var(--bg-card-hover);
            border-color: var(--border-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        /* Estilos para o footer */
        .site-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: var(--spacing-lg) 0;
            margin-top: var(--spacing-2xl);
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        .footer-logo {
            max-width: 100px;
            height: auto;
            margin-bottom: var(--spacing-md);
        }

        .site-domain, .copyright-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin: var(--spacing-xs) 0;
        }

        /* Responsividade melhorada */
        @media (max-width: 767px) {
            .main-title { 
                font-size: clamp(1.8rem, 5vw, 2.2rem); 
                margin-bottom: var(--spacing-lg);
            }
            
            .card-subtitle {
                font-size: clamp(1.2rem, 3.5vw, 1.4rem);
                margin-bottom: var(--spacing-lg);
            }
            
            .palpites-card {
                padding: var(--spacing-md);
            }
            
            .palpite-row {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-md);
                padding: var(--spacing-md);
            }

            .palpite-row .select-group-btn, 
            .palpite-row .clear-btn {
                width: 100%;
                padding: var(--spacing-md);
                font-size: 1rem;
                margin-bottom: var(--spacing-sm);
            }

            .palpite-row .group-info {
                text-align: center;
                margin: 0;
                font-size: 1rem;
                margin-bottom: var(--spacing-sm);
            }

            .palpite-row .input-xy-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: var(--spacing-sm);
                width: 100%;
            }

            .palpite-row .input-xy {
                justify-content: center;
                padding: var(--spacing-sm);
                background: var(--bg-secondary);
                border-radius: var(--radius-md);
            }

            .palpite-row .input-x, 
            .palpite-row .input-y {
                width: 45px;
                height: 45px;
                font-size: 1rem;
                font-weight: 700;
            }

            .main-action-buttons,
            .edit-action-buttons {
                flex-direction: column;
                gap: var(--spacing-md);
                margin-top: var(--spacing-lg);
            }

            .main-action-buttons .btn,
            .edit-action-buttons .btn {
                width: 100%;
                padding: var(--spacing-lg);
                font-size: 1rem;
                letter-spacing: 0.3px;
            }

            /* Modal responsivo */
            .modal-content {
                width: 95%;
                max-width: none;
                margin: var(--spacing-sm);
            }

            .modal-body {
                padding: var(--spacing-md);
                max-height: 70vh;
            }

            .modal-group-list li {
                padding: var(--spacing-md);
                font-size: 0.9rem;
                line-height: 1.4;
            }

            /* Modal de imagem responsivo - Atualizado para seguir o padrão do index(3).html */
            .image-modal-content {
                width: 95%;
                max-width: none;
                margin: 1vh auto;
                height: auto;
                max-height: 98vh;
                border-radius: var(--radius-lg);
            }

            .image-modal-header {
                padding: var(--spacing-md);
            }

            .image-modal-title {
                font-size: 1.2rem;
            }

            .image-modal-close {
                width: 36px;
                height: 36px;
                font-size: 1.2rem;
            }

            .image-modal-body {
                padding: var(--spacing-md);
            }

            .image-modal-body img {
                max-height: calc(98vh - 140px);
                border-radius: var(--radius-md);
            }

            .image-modal-footer {
                padding: var(--spacing-md);
                flex-direction: row;
                gap: var(--spacing-sm);
            }

            .image-modal-footer .btn {
                padding: var(--spacing-md);
                font-size: 0.9rem;
                min-width: 120px;
            }

            .image-modal-footer .btn {
                width: 100%;
                min-width: auto;
                padding: var(--spacing-md);
                font-size: 0.95rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .header {
                padding-top: var(--spacing-md);
                margin-bottom: var(--spacing-lg);
            }

            .main-title {
                font-size: clamp(1.5rem, 4.5vw, 1.8rem);
            }
            
            .palpites-card {
                padding: var(--spacing-sm);
            }

            .card-subtitle {
                font-size: clamp(1.1rem, 3vw, 1.3rem);
                text-align: center;
            }

            .palpite-row {
                padding: var(--spacing-sm);
                gap: var(--spacing-sm);
            }

            .palpite-row .input-xy-container {
                grid-template-columns: 1fr 1fr;
                gap: var(--spacing-xs);
            }

            .palpite-row .input-x, 
            .palpite-row .input-y {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }

            .main-action-buttons,
            .edit-action-buttons {
                gap: var(--spacing-sm);
            }

            .main-action-buttons .btn,
            .edit-action-buttons .btn {
                font-size: 0.9rem;
            }

            /* Breadcrumb responsivo */
            .breadcrumb {
                font-size: 0.8rem;
                gap: var(--spacing-xs);
            }

            .breadcrumb-item {
                gap: var(--spacing-xs);
            }

            /* Footer responsivo */
            .footer-logo {
                max-width: 80px;
            }

            .site-domain, .copyright-text {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 360px) {
            .main-title {
                font-size: 1.4rem;
                line-height: 1.3;
            }

            .card-subtitle {
                font-size: 1.1rem;
            }

            .palpite-row .input-xy-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-xs);
            }

            .palpite-row .input-xy {
                justify-content: space-between;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .main-action-buttons .btn,
            .edit-action-buttons .btn {
                font-size: 0.85rem;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }
    </style>
</head>

<body>
    <nav class="breadcrumb-nav" id="breadcrumbNav">
      <!-- O breadcrumb será gerado dinamicamente pelo JavaScript -->
    </nav>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">CRIE UMA IMAGEM DE DIVULGAÇÃO</h1>
        </div>

        <!-- Card de Palpites -->
        <div class="palpites-card">
            <h2 class="card-subtitle">PALPITES DO DIA</h2>

            <!-- Botões principais (visíveis por padrão) -->
            <div class="main-action-buttons" id="main-action-buttons">
                <button class="btn" id="visualizar-btn">Visualizar</button>
                <button class="btn secondary" id="baixar-btn">Baixar</button>
                <button class="btn secondary" id="compartilhar-btn">Compartilhar</button>
                <button class="btn secondary" id="editar-btn">Editar</button>
                <button class="btn secondary" id="copiar-legenda-btn">Copiar legenda</button>
            </div>

            <!-- Linhas de palpite (ocultas por padrão) -->
            <div id="palpites-rows" class="palpites-rows hidden">
                <!-- As linhas de palpite serão geradas dinamicamente pelo JavaScript -->
            </div>

            <!-- Botões de edição (ocultos por padrão) -->
            <div class="edit-action-buttons" id="edit-action-buttons">
                <button class="btn" id="preencher-btn">Completar números</button>
                <button class="btn secondary" id="sortear-grupos-btn">Completar Grupos</button>
                <button class="btn secondary" id="apagar-btn">Apagar tudo</button>
                <button class="btn secondary" id="visualizar-edicao-btn">Visualizar Imagem</button>
                <button class="btn secondary" id="voltar-btn">Voltar</button>
                <button class="btn secondary" id="copiar-legenda-edicao-btn">Copiar legenda</button>
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Grupo -->
    <div id="groupSelectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Selecionar Grupo</h3>
                <span class="close-btn" onclick="closeModal('groupSelectionModal')">&times;</span>
            </div>
            <div class="modal-body">
                <ul class="modal-group-list" id="group-list">
                    <!-- Grupos serão carregados aqui pelo JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal de Visualização da Imagem -->
    <div id="imagePreviewModal" class="image-modal">
        <div class="image-modal-content">
            <div class="image-modal-header">
                <h3 class="image-modal-title">Pré-visualização da Imagem</h3>
                <span class="image-modal-close" onclick="closeModal('imagePreviewModal')">&times;</span>
            </div>
            <div class="image-modal-body">
                <img id="generatedImage" src="" alt="Imagem Gerada">
            </div>
            <div class="image-modal-footer">
                <button class="btn" id="downloadImageBtn">Baixar Imagem</button>
                <button class="btn" id="shareImageBtn">Compartilhar</button>
                <button class="btn secondary" id="editImageFromModalBtn">Editar</button>
            </div>
        </div>
    </div>

    <!-- Toast para mensagens flutuantes -->
    <div id="toast" class="toast">
        <span id="toast-message"></span>
    </div>

    <!-- Script do site -->
    <script defer src="/assets/js/breadcrumb.js"></script>
    <script defer src="/resultados/script.js"></script>
    
    <!-- Script personalizado para esta página -->
    <script>
        // Variáveis globais e dados dos grupos do jogo do bicho
        const grupos = [
            { numero: '01', nome: 'Avestruz', dezenas: ['01', '02', '03', '04'] },
            { numero: '02', nome: 'Águia', dezenas: ['05', '06', '07', '08'] },
            { numero: '03', nome: 'Burro', dezenas: ['09', '10', '11', '12'] },
            { numero: '04', nome: 'Borboleta', dezenas: ['13', '14', '15', '16'] },
            { numero: '05', nome: 'Cachorro', dezenas: ['17', '18', '19', '20'] },
            { numero: '06', nome: 'Cabra', dezenas: ['21', '22', '23', '24'] },
            { numero: '07', nome: 'Carneiro', dezenas: ['25', '26', '27', '28'] },
            { numero: '08', nome: 'Camelo', dezenas: ['29', '30', '31', '32'] },
            { numero: '09', nome: 'Cobra', dezenas: ['33', '34', '35', '36'] },
            { numero: '10', nome: 'Coelho', dezenas: ['37', '38', '39', '40'] },
            { numero: '11', nome: 'Cavalo', dezenas: ['41', '42', '43', '44'] },
            { numero: '12', nome: 'Elefante', dezenas: ['45', '46', '47', '48'] },
            { numero: '13', nome: 'Galo', dezenas: ['49', '50', '51', '52'] },
            { numero: '14', nome: 'Gato', dezenas: ['53', '54', '55', '56'] },
            { numero: '15', nome: 'Jacaré', dezenas: ['57', '58', '59', '60'] },
            { numero: '16', nome: 'Leão', dezenas: ['61', '62', '63', '64'] },
            { numero: '17', nome: 'Macaco', dezenas: ['65', '66', '67', '68'] },
            { numero: '18', nome: 'Porco', dezenas: ['69', '70', '71', '72'] },
            { numero: '19', nome: 'Pavão', dezenas: ['73', '74', '75', '76'] },
            { numero: '20', nome: 'Peru', dezenas: ['77', '78', '79', '80'] },
            { numero: '21', nome: 'Touro', dezenas: ['81', '82', '83', '84'] },
            { numero: '22', nome: 'Tigre', dezenas: ['85', '86', '87', '88'] },
            { numero: '23', nome: 'Urso', dezenas: ['89', '90', '91', '92'] },
            { numero: '24', nome: 'Veado', dezenas: ['93', '94', '95', '96'] },
            { numero: '25', nome: 'Vaca', dezenas: ['97', '98', '99', '00'] }
        ];

        let currentSelectingRow = null; // Armazena a linha que acionou o modal
        let isEditMode = false; // Controla se está no modo de edição

        document.addEventListener('DOMContentLoaded', function() {
            // Função do script.js para capturar parâmetros
            if (typeof captureAndStoreUrlParameter === 'function') {
                captureAndStoreUrlParameter();
            }

            // Gerar breadcrumb dinamicamente
            const breadcrumbNav = document.getElementById('breadcrumbNav');
            if (breadcrumbNav) {
                breadcrumbNav.innerHTML = `
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/" class="breadcrumb-link">Início</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/ferramentas/" class="breadcrumb-link">Ferramentas</a>
                        </li>
                        <li class="breadcrumb-item">
                            <span class="breadcrumb-current">Criar Imagem de Divulgação</span>
                        </li>
                    </ol>
                `;
            }

            // Gerar footer dinamicamente
            const siteDomain = document.getElementById('siteDomain');
            const copyrightText = document.getElementById('copyrightText');
            if (siteDomain) {
                siteDomain.textContent = window.location.hostname;
            }
            if (copyrightText) {
                const currentYear = new Date().getFullYear();
                copyrightText.textContent = `© ${currentYear} 77x Brasil. Todos os direitos reservados.`;
            }

            // Gerar as 4 linhas de palpite
            const palpitesRowsContainer = document.getElementById('palpites-rows');
            for (let i = 0; i < 4; i++) {
                const row = document.createElement('div');
                row.className = 'palpite-row';
                row.dataset.rowIndex = i; // Adiciona um índice para identificar a linha
                row.innerHTML = `
                    <button class="select-group-btn">Selecionar Grupo</button>
                    <span class="group-info"></span>
                    <div class="input-xy-container">
                        <div class="input-xy"><input type="text" class="input-x" maxlength="2" pattern="[0-9]*"><span class="input-y"></span></div>
                        <div class="input-xy"><input type="text" class="input-x" maxlength="2" pattern="[0-9]*"><span class="input-y"></span></div>
                        <div class="input-xy"><input type="text" class="input-x" maxlength="2" pattern="[0-9]*"><span class="input-y"></span></div>
                        <div class="input-xy"><input type="text" class="input-x" maxlength="2" pattern="[0-9]*"><span class="input-y"></span></div>
                    </div>
                    <button class="clear-btn">Apagar</button>
                `;
                palpitesRowsContainer.appendChild(row);
            }

            // Popular o modal de seleção de grupo
            const groupList = document.getElementById('group-list');
            grupos.forEach(grupo => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>Grupo ${grupo.numero} ${grupo.nome}</strong><br><small>(${grupo.dezenas.join(', ')})</small>`;
                li.dataset.grupoNumero = grupo.numero;
                li.dataset.grupoNome = grupo.nome;
                li.dataset.grupoDezenas = grupo.dezenas.join(',');
                li.addEventListener('click', function() {
                    selectGroup(this.dataset.grupoNumero, this.dataset.grupoNome, this.dataset.grupoDezenas.split(','));
                });
                groupList.appendChild(li);
            });

            // Event Listeners para os botões de cada linha
            document.querySelectorAll('.select-group-btn').forEach(button => {
                button.addEventListener('click', function() {
                    currentSelectingRow = this.closest('.palpite-row');
                    openModal('groupSelectionModal');
                });
            });

            document.querySelectorAll('.clear-btn').forEach(button => {
                button.addEventListener('click', function() {
                    clearRow(this.closest('.palpite-row'));
                });
            });

            // Event Listeners para os botões principais
            document.getElementById('visualizar-btn').addEventListener('click', function() {
                fillAllEmptyX();
                sortearGrupos();
                setTimeout(() => {
                    visualizeImage(); // Apenas visualiza, abre o modal
                }, 100);
            });

            document.getElementById('baixar-btn').addEventListener('click', function() {
                fillAllEmptyX();
                sortearGrupos();
                setTimeout(() => {
                    visualizeImageAndDownload(); // Gera e baixa, sem abrir modal
                }, 100);
            });

            document.getElementById('compartilhar-btn').addEventListener('click', function() {
                fillAllEmptyX();
                sortearGrupos();
                setTimeout(() => {
                    visualizeImageAndShare(); // Gera e compartilha, sem abrir modal
                }, 100);
            });
            document.getElementById('editar-btn').addEventListener('click', function() {
                toggleEditMode(true);
            });
            document.getElementById('copiar-legenda-btn').addEventListener('click', copiarLegenda);

            // Event Listeners para os botões de edição
            document.getElementById('preencher-btn').addEventListener('click', fillAllEmptyX);
            document.getElementById('sortear-grupos-btn').addEventListener('click', sortearGrupos);
            document.getElementById('apagar-btn').addEventListener('click', clearAll);
            document.getElementById('visualizar-edicao-btn').addEventListener('click', visualizeImage);
            document.getElementById('voltar-btn').addEventListener('click', function() {
                toggleEditMode(false);
            });
            document.getElementById('copiar-legenda-edicao-btn').addEventListener('click', copiarLegenda);

            // Event Listeners para os botões do modal de imagem
            document.getElementById('downloadImageBtn').addEventListener('click', downloadGeneratedImage);
            document.getElementById('shareImageBtn').addEventListener('click', shareGeneratedImage);
            document.getElementById('editImageFromModalBtn').addEventListener('click', function() {
                closeModal('imagePreviewModal');
                toggleEditMode(true);
            });
        });

        // Função para alternar entre modo normal e modo de edição
        function toggleEditMode(editMode) {
            isEditMode = editMode;
            const mainButtons = document.getElementById('main-action-buttons');
            const editButtons = document.getElementById('edit-action-buttons');
            const palpitesRows = document.getElementById('palpites-rows');

            if (editMode) {
                mainButtons.style.display = 'none';
                editButtons.style.display = 'flex';
                palpitesRows.classList.remove('hidden');
            } else {
                mainButtons.style.display = 'flex';
                editButtons.style.display = 'none';
                palpitesRows.classList.add('hidden');
            }
        }

        // Função para selecionar um grupo
        function selectGroup(numero, nome, dezenas) {
            if (currentSelectingRow) {
                currentSelectingRow.dataset.grupoNumero = numero;
                currentSelectingRow.dataset.grupoNome = nome;
                currentSelectingRow.querySelector('.group-info').textContent = `Grupo ${numero} ${nome}:`;
                const inputYs = currentSelectingRow.querySelectorAll('.input-y');
                dezenas.forEach((dezena, index) => {
                    if (inputYs[index]) {
                        inputYs[index].textContent = dezena;
                    }
                });
                closeModal('groupSelectionModal');
                currentSelectingRow = null;
            }
        }

        // Função para limpar uma linha específica
        function clearRow(row) {
            row.removeAttribute('data-grupo-numero');
            row.removeAttribute('data-grupo-nome');
            row.querySelector('.group-info').textContent = '';
            const inputXs = row.querySelectorAll('.input-x');
            const inputYs = row.querySelectorAll('.input-y');
            inputXs.forEach(input => input.value = '');
            inputYs.forEach(span => span.textContent = '');
        }

        // Função para limpar todas as linhas
        function clearAll() {
            const rows = document.querySelectorAll('.palpite-row');
            rows.forEach(row => clearRow(row));
        }

        // Função para preencher automaticamente os campos X vazios
        function fillAllEmptyX() {
            const rows = document.querySelectorAll('.palpite-row');
            rows.forEach(row => {
                const inputXs = row.querySelectorAll('.input-x');
                inputXs.forEach(input => {
                    if (!input.value.trim()) {
                        // Gerar número aleatório de 00 a 99
                        const randomNum = Math.floor(Math.random() * 100);
                        input.value = randomNum.toString().padStart(2, '0');
                    }
                });
            });
        }

        // Função para sortear grupos aleatórios
        function sortearGrupos() {
            const rows = document.querySelectorAll('.palpite-row');
            const gruposUsados = new Set();
            
            rows.forEach(row => {
                // Só sortear se a linha não tem grupo definido
                if (!row.dataset.grupoNumero) {
                    let grupoSorteado;
                    do {
                        grupoSorteado = grupos[Math.floor(Math.random() * grupos.length)];
                    } while (gruposUsados.has(grupoSorteado.numero) && gruposUsados.size < grupos.length);
                    
                    gruposUsados.add(grupoSorteado.numero);
                    selectGroupForRow(row, grupoSorteado.numero, grupoSorteado.nome, grupoSorteado.dezenas);
                }
            });
        }

        // Função auxiliar para selecionar grupo para uma linha específica
        function selectGroupForRow(row, numero, nome, dezenas) {
            row.dataset.grupoNumero = numero;
            row.dataset.grupoNome = nome;
            row.querySelector('.group-info').textContent = `Grupo ${numero} ${nome}:`;
            const inputYs = row.querySelectorAll('.input-y');
            dezenas.forEach((dezena, index) => {
                if (inputYs[index]) {
                    inputYs[index].textContent = dezena;
                }
            });
        }

        // Função para visualizar a imagem
        async function visualizeImage() {
            const rows = document.querySelectorAll('.palpite-row');
            const validRows = [];

            // Validar e coletar dados das linhas preenchidas
            for (let row of rows) {
                const grupoNumero = row.dataset.grupoNumero;
                const grupoNome = row.dataset.grupoNome;
                const inputXs = row.querySelectorAll('.input-x');
                const inputYs = row.querySelectorAll('.input-y');

                if (grupoNumero && grupoNome) {
                    const fullNumbers = [];
                    let allFilled = true;

                    for (let i = 0; i < inputXs.length; i++) {
                        const xValue = inputXs[i].value.trim();
                        const yValue = inputYs[i].textContent.trim();

                        if (xValue && yValue) {
                            fullNumbers.push(xValue + yValue);
                        } else {
                            allFilled = false;
                            break;
                        }
                    }

                    if (allFilled && fullNumbers.length === 4) {
                        validRows.push({
                            grupoNumero,
                            grupoNome,
                            fullNumbers
                        });
                    }
                }
            }

            if (validRows.length === 0) {
                alert('Por favor, selecione pelo menos um grupo e preencha todos os campos de palpite antes de visualizar.');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Dimensões da imagem (ajustar conforme necessário)
            canvas.width = 600; 
            canvas.height = 180 + (validRows.length * 130) + 120; // Altura dinâmica baseada no número de linhas

            try {
                // Carregar imagem de fundo
                const backgroundImage = new Image();
                backgroundImage.crossOrigin = 'anonymous';
                backgroundImage.src = '/assets/img/palpites/backg1.webp';
                await new Promise((resolve, reject) => {
                    backgroundImage.onload = resolve;
                    backgroundImage.onerror = () => {
                        // Se não conseguir carregar a imagem de fundo, usar cor sólida
                        ctx.fillStyle = '#041228';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        resolve();
                    };
                });
                
                if (backgroundImage.complete && backgroundImage.naturalWidth > 0) {
                    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                } else {
                    // Fallback para cor sólida
                    ctx.fillStyle = '#041228';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Data e Dia da Semana
                const today = new Date();
                const dateStr = today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit' });
                const dayOfWeekStr = today.toLocaleDateString('pt-BR', { weekday: 'long' });

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(dateStr, canvas.width / 2, 40);

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = '#F1D14C';
                ctx.fillText(dayOfWeekStr.charAt(0).toUpperCase() + dayOfWeekStr.slice(1), canvas.width / 2, 70);

                // Título
                ctx.font = 'bold 48px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.fillText('PALPITES DO DIA', canvas.width / 2, 120);

                // Desenhar as linhas de palpite válidas
                let startY = 150;
                const rowHeight = 130;
                const imageSize = 120;

                for (let i = 0; i < validRows.length; i++) {
                    const rowData = validRows[i];

                    try {
                        // Carregar imagem do grupo
                        const groupImage = new Image();
                        groupImage.crossOrigin = 'anonymous';
                        groupImage.src = `/assets/img/grupos/${rowData.grupoNumero}.webp`;
                        await new Promise((resolve, reject) => {
                            groupImage.onload = resolve;
                            groupImage.onerror = () => {
                                // Se não conseguir carregar a imagem do grupo, desenhar um círculo colorido
                                ctx.fillStyle = '#4FA2E8';
                                ctx.beginPath();
                                ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                                ctx.fill();
                                resolve();
                            };
                        });

                        // Desenhar imagem do grupo (arredondada)
                        if (groupImage.complete && groupImage.naturalWidth > 0) {
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2, false);
                            ctx.clip();
                            ctx.drawImage(groupImage, 50, startY, imageSize, imageSize);
                            ctx.restore();
                        } else {
                            // Fallback para círculo colorido
                            ctx.fillStyle = '#4FA2E8';
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                            ctx.fill();
                        }

                        // Nome do animal e número do grupo
                        ctx.font = 'bold 28px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${rowData.grupoNome.toUpperCase()} GRUPO ${rowData.grupoNumero}`, 50 + imageSize + 20, startY + 40);

                        // Números completos em retângulos brancos
                        const numbersText = rowData.fullNumbers.join(' ');
                        const textX = 50 + imageSize + 20;
                        const textY = startY + 85;
                        
                        // Medir o texto para criar o retângulo
                        ctx.font = 'bold 32px JetBrains Mono, monospace';
                        const textMetrics = ctx.measureText(numbersText);
                        const textWidth = textMetrics.width;
                        const textHeight = 40; // Altura aproximada da fonte
                        
                        // Desenhar retângulo branco
                        ctx.fillStyle = 'white';
                        ctx.fillRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar borda do retângulo (opcional)
                        ctx.strokeStyle = '#cccccc';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar texto em preto
                        ctx.fillStyle = 'black';
                        ctx.fillText(numbersText, textX, textY);

                        startY += rowHeight;
                    } catch (error) {
                        console.error('Erro ao carregar imagem do grupo:', error);
                        // Continuar com o próximo grupo mesmo se houver erro
                        startY += rowHeight;
                    }
                }

                // Logo do site
                try {
                    const logoImage = new Image();
                    logoImage.crossOrigin = 'anonymous';
                    logoImage.src = '/assets/img/logo.webp';
                    await new Promise((resolve, reject) => {
                        logoImage.onload = resolve;
                        logoImage.onerror = () => {
                            // Se não conseguir carregar o logo, desenhar texto
                            ctx.font = 'bold 16px Inter, sans-serif';
                            ctx.fillStyle = 'white';
                            ctx.textAlign = 'center';
                            ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                            resolve();
                        };
                    });
                    
                    if (logoImage.complete && logoImage.naturalWidth > 0) {
                        ctx.drawImage(logoImage, canvas.width / 2 - 75, canvas.height - 90, 150, 75);
                    } else {
                        // Fallback para texto
                        ctx.font = 'bold 20px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                    }
                } catch (error) {
                    console.error('Erro ao carregar logo:', error);
                    // Fallback para texto
                    ctx.font = 'bold 20px Inter, sans-serif';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                }

                const imageDataUrl = canvas.toDataURL('image/png');
                document.getElementById('generatedImage').src = imageDataUrl;
                openModal('imagePreviewModal');

            } catch (error) {
                console.error('Erro ao gerar imagem:', error);
                alert('Erro ao gerar a imagem. Por favor, tente novamente.');
            }
        }

        // Função para visualizar e baixar automaticamente
        async function visualizeImageAndDownload() {
            const rows = document.querySelectorAll('.palpite-row');
            const validRows = [];

            // Validar e coletar dados das linhas preenchidas
            for (let row of rows) {
                const grupoNumero = row.dataset.grupoNumero;
                const grupoNome = row.dataset.grupoNome;
                const inputXs = row.querySelectorAll('.input-x');
                const inputYs = row.querySelectorAll('.input-y');

                if (grupoNumero && grupoNome) {
                    const fullNumbers = [];
                    let allFilled = true;

                    for (let i = 0; i < inputXs.length; i++) {
                        const xValue = inputXs[i].value.trim();
                        const yValue = inputYs[i].textContent.trim();

                        if (xValue && yValue) {
                            fullNumbers.push(xValue + yValue);
                        } else {
                            allFilled = false;
                            break;
                        }
                    }

                    if (allFilled && fullNumbers.length === 4) {
                        validRows.push({
                            grupoNumero,
                            grupoNome,
                            fullNumbers
                        });
                    }
                }
            }

            if (validRows.length === 0) {
                alert('Por favor, selecione pelo menos um grupo e preencha todos os campos de palpite antes de baixar.');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Dimensões da imagem (ajustar conforme necessário)
            canvas.width = 600; 
            canvas.height = 180 + (validRows.length * 130) + 120; // Altura dinâmica baseada no número de linhas

            try {
                // Carregar imagem de fundo
                const backgroundImage = new Image();
                backgroundImage.crossOrigin = 'anonymous';
                backgroundImage.src = '/assets/img/palpites/backg1.webp';
                await new Promise((resolve, reject) => {
                    backgroundImage.onload = resolve;
                    backgroundImage.onerror = () => {
                        // Se não conseguir carregar a imagem de fundo, usar cor sólida
                        ctx.fillStyle = '#041228';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        resolve();
                    };
                });
                
                if (backgroundImage.complete && backgroundImage.naturalWidth > 0) {
                    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                } else {
                    // Fallback para cor sólida
                    ctx.fillStyle = '#041228';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Data e Dia da Semana
                const today = new Date();
                const dateStr = today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit' });
                const dayOfWeekStr = today.toLocaleDateString('pt-BR', { weekday: 'long' });

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(dateStr, canvas.width / 2, 40);

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = '#F1D14C';
                ctx.fillText(dayOfWeekStr.charAt(0).toUpperCase() + dayOfWeekStr.slice(1), canvas.width / 2, 70);

                // Título
                ctx.font = 'bold 48px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.fillText('PALPITES DO DIA', canvas.width / 2, 120);

                // Desenhar as linhas de palpite válidas
                let startY = 150;
                const rowHeight = 130;
                const imageSize = 120;

                for (let i = 0; i < validRows.length; i++) {
                    const rowData = validRows[i];

                    try {
                        // Carregar imagem do grupo
                        const groupImage = new Image();
                        groupImage.crossOrigin = 'anonymous';
                        groupImage.src = `/assets/img/grupos/${rowData.grupoNumero}.webp`;
                        await new Promise((resolve, reject) => {
                            groupImage.onload = resolve;
                            groupImage.onerror = () => {
                                // Se não conseguir carregar a imagem do grupo, desenhar um círculo colorido
                                ctx.fillStyle = '#4FA2E8';
                                ctx.beginPath();
                                ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                                ctx.fill();
                                resolve();
                            };
                        });

                        // Desenhar imagem do grupo (arredondada)
                        if (groupImage.complete && groupImage.naturalWidth > 0) {
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2, false);
                            ctx.clip();
                            ctx.drawImage(groupImage, 50, startY, imageSize, imageSize);
                            ctx.restore();
                        } else {
                            // Fallback para círculo colorido
                            ctx.fillStyle = '#4FA2E8';
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                            ctx.fill();
                        }

                        // Nome do animal e número do grupo
                        ctx.font = 'bold 28px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${rowData.grupoNome.toUpperCase()} GRUPO ${rowData.grupoNumero}`, 50 + imageSize + 20, startY + 40);

                        // Números completos em retângulos brancos
                        const numbersText = rowData.fullNumbers.join(' ');
                        const textX = 50 + imageSize + 20;
                        const textY = startY + 85;
                        
                        // Medir o texto para criar o retângulo
                        ctx.font = 'bold 32px JetBrains Mono, monospace';
                        const textMetrics = ctx.measureText(numbersText);
                        const textWidth = textMetrics.width;
                        const textHeight = 40; // Altura aproximada da fonte
                        
                        // Desenhar retângulo branco
                        ctx.fillStyle = 'white';
                        ctx.fillRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar borda do retângulo (opcional)
                        ctx.strokeStyle = '#cccccc';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar texto em preto
                        ctx.fillStyle = 'black';
                        ctx.fillText(numbersText, textX, textY);

                        startY += rowHeight;
                    } catch (error) {
                        console.error('Erro ao carregar imagem do grupo:', error);
                        // Continuar com o próximo grupo mesmo se houver erro
                        startY += rowHeight;
                    }
                }

                // Logo do site
                try {
                    const logoImage = new Image();
                    logoImage.crossOrigin = 'anonymous';
                    logoImage.src = '/assets/img/logo.webp';
                    await new Promise((resolve, reject) => {
                        logoImage.onload = resolve;
                        logoImage.onerror = () => {
                            // Se não conseguir carregar o logo, desenhar texto
                            ctx.font = 'bold 16px Inter, sans-serif';
                            ctx.fillStyle = 'white';
                            ctx.textAlign = 'center';
                            ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                            resolve();
                        };
                    });
                    
                    if (logoImage.complete && logoImage.naturalWidth > 0) {
                        ctx.drawImage(logoImage, canvas.width / 2 - 75, canvas.height - 90, 150, 75);
                    } else {
                        // Fallback para texto
                        ctx.font = 'bold 20px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                    }
                } catch (error) {
                    console.error('Erro ao carregar logo:', error);
                    // Fallback para texto
                    ctx.font = 'bold 20px Inter, sans-serif';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                }

                const imageDataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = imageDataUrl;
                link.download = 'palpite_77xbrasil.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
                console.error('Erro ao gerar imagem para download:', error);
                alert('Erro ao gerar a imagem para download. Por favor, tente novamente.');
            }
        }

        // Função para visualizar e compartilhar automaticamente
        async function visualizeImageAndShare() {
            const rows = document.querySelectorAll('.palpite-row');
            const validRows = [];

            // Validar e coletar dados das linhas preenchidas
            for (let row of rows) {
                const grupoNumero = row.dataset.grupoNumero;
                const grupoNome = row.dataset.grupoNome;
                const inputXs = row.querySelectorAll('.input-x');
                const inputYs = row.querySelectorAll('.input-y');

                if (grupoNumero && grupoNome) {
                    const fullNumbers = [];
                    let allFilled = true;

                    for (let i = 0; i < inputXs.length; i++) {
                        const xValue = inputXs[i].value.trim();
                        const yValue = inputYs[i].textContent.trim();

                        if (xValue && yValue) {
                            fullNumbers.push(xValue + yValue);
                        } else {
                            allFilled = false;
                            break;
                        }
                    }

                    if (allFilled && fullNumbers.length === 4) {
                        validRows.push({
                            grupoNumero,
                            grupoNome,
                            fullNumbers
                        });
                    }
                }
            }

            if (validRows.length === 0) {
                alert('Por favor, selecione pelo menos um grupo e preencha todos os campos de palpite antes de compartilhar.');
                return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Dimensões da imagem (ajustar conforme necessário)
            canvas.width = 600; 
            canvas.height = 180 + (validRows.length * 130) + 120; // Altura dinâmica baseada no número de linhas

            try {
                // Carregar imagem de fundo
                const backgroundImage = new Image();
                backgroundImage.crossOrigin = 'anonymous';
                backgroundImage.src = '/assets/img/palpites/backg1.webp';
                await new Promise((resolve, reject) => {
                    backgroundImage.onload = resolve;
                    backgroundImage.onerror = () => {
                        // Se não conseguir carregar a imagem de fundo, usar cor sólida
                        ctx.fillStyle = '#041228';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        resolve();
                    };
                });
                
                if (backgroundImage.complete && backgroundImage.naturalWidth > 0) {
                    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                } else {
                    // Fallback para cor sólida
                    ctx.fillStyle = '#041228';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Data e Dia da Semana
                const today = new Date();
                const dateStr = today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit' });
                const dayOfWeekStr = today.toLocaleDateString('pt-BR', { weekday: 'long' });

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText(dateStr, canvas.width / 2, 40);

                ctx.font = 'bold 24px Inter, sans-serif';
                ctx.fillStyle = '#F1D14C';
                ctx.fillText(dayOfWeekStr.charAt(0).toUpperCase() + dayOfWeekStr.slice(1), canvas.width / 2, 70);

                // Título
                ctx.font = 'bold 48px Inter, sans-serif';
                ctx.fillStyle = 'white';
                ctx.fillText('PALPITES DO DIA', canvas.width / 2, 120);

                // Desenhar as linhas de palpite válidas
                let startY = 150;
                const rowHeight = 130;
                const imageSize = 120;

                for (let i = 0; i < validRows.length; i++) {
                    const rowData = validRows[i];

                    try {
                        // Carregar imagem do grupo
                        const groupImage = new Image();
                        groupImage.crossOrigin = 'anonymous';
                        groupImage.src = `/assets/img/grupos/${rowData.grupoNumero}.webp`;
                        await new Promise((resolve, reject) => {
                            groupImage.onload = resolve;
                            groupImage.onerror = () => {
                                // Se não conseguir carregar a imagem do grupo, desenhar um círculo colorido
                                ctx.fillStyle = '#4FA2E8';
                                ctx.beginPath();
                                ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                                ctx.fill();
                                resolve();
                            };
                        });

                        // Desenhar imagem do grupo (arredondada)
                        if (groupImage.complete && groupImage.naturalWidth > 0) {
                            ctx.save();
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2, false);
                            ctx.clip();
                            ctx.drawImage(groupImage, 50, startY, imageSize, imageSize);
                            ctx.restore();
                        } else {
                            // Fallback para círculo colorido
                            ctx.fillStyle = '#4FA2E8';
                            ctx.beginPath();
                            ctx.arc(50 + imageSize / 2, startY + imageSize / 2, imageSize / 2, 0, Math.PI * 2);
                            ctx.fill();
                        }

                        // Nome do animal e número do grupo
                        ctx.font = 'bold 28px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'left';
                        ctx.fillText(`${rowData.grupoNome.toUpperCase()} GRUPO ${rowData.grupoNumero}`, 50 + imageSize + 20, startY + 40);

                        // Números completos em retângulos brancos
                        const numbersText = rowData.fullNumbers.join(' ');
                        const textX = 50 + imageSize + 20;
                        const textY = startY + 85;
                        
                        // Medir o texto para criar o retângulo
                        ctx.font = 'bold 32px JetBrains Mono, monospace';
                        const textMetrics = ctx.measureText(numbersText);
                        const textWidth = textMetrics.width;
                        const textHeight = 40; // Altura aproximada da fonte
                        
                        // Desenhar retângulo branco
                        ctx.fillStyle = 'white';
                        ctx.fillRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar borda do retângulo (opcional)
                        ctx.strokeStyle = '#cccccc';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(textX - 5, textY - textHeight + 5, textWidth + 10, textHeight + 5);
                        
                        // Desenhar texto em preto
                        ctx.fillStyle = 'black';
                        ctx.fillText(numbersText, textX, textY);

                        startY += rowHeight;
                    } catch (error) {
                        console.error('Erro ao carregar imagem do grupo:', error);
                        // Continuar com o próximo grupo mesmo se houver erro
                        startY += rowHeight;
                    }
                }

                // Logo do site
                try {
                    const logoImage = new Image();
                    logoImage.crossOrigin = 'anonymous';
                    logoImage.src = '/assets/img/logo.webp';
                    await new Promise((resolve, reject) => {
                        logoImage.onload = resolve;
                        logoImage.onerror = () => {
                            // Se não conseguir carregar o logo, desenhar texto
                            ctx.font = 'bold 16px Inter, sans-serif';
                            ctx.fillStyle = 'white';
                            ctx.textAlign = 'center';
                            ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                            resolve();
                        };
                    });
                    
                    if (logoImage.complete && logoImage.naturalWidth > 0) {
                        ctx.drawImage(logoImage, canvas.width / 2 - 75, canvas.height - 90, 150, 75);
                    } else {
                        // Fallback para texto
                        ctx.font = 'bold 20px Inter, sans-serif';
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                    }
                } catch (error) {
                    console.error('Erro ao carregar logo:', error);
                    // Fallback para texto
                    ctx.font = 'bold 20px Inter, sans-serif';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.fillText('77x Brasil', canvas.width / 2, canvas.height - 30);
                }

                const imageDataUrl = canvas.toDataURL('image/png');
                // Não abre o modal aqui, apenas compartilha
                const imageBlob = await (await fetch(imageDataUrl)).blob();
                if (navigator.share && navigator.canShare({ files: [new File([imageBlob], 'palpite.png', { type: 'image/png' })] })) {
                    await navigator.share({
                        files: [new File([imageBlob], 'palpite.png', { type: 'image/png' })],
                        title: 'Meu Palpite 77x Brasil',
                        text: 'Confira meu palpite para o jogo do bicho!'
                    });
                } else {
                    alert('Compartilhamento não suportado neste navegador. Por favor, baixe a imagem e compartilhe manualmente.');
                }

            } catch (error) {
                console.error('Erro ao gerar imagem para compartilhamento:', error);
                alert('Erro ao gerar a imagem para compartilhamento. Por favor, tente novamente.');
            }
        }

        // Função para download da imagem gerada
        function downloadGeneratedImage() {
            const image = document.getElementById('generatedImage').src;
            const link = document.createElement('a');
            link.href = image;
            link.download = 'palpite_77xbrasil.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Função para compartilhar a imagem gerada (usando a função existente do script.js)
        async function shareGeneratedImage() {
            const imageBlob = await (await fetch(document.getElementById('generatedImage').src)).blob();
            if (navigator.share && navigator.canShare({ files: [new File([imageBlob], 'palpite.png', { type: 'image/png' })] })) {
                await navigator.share({
                    files: [new File([imageBlob], 'palpite.png', { type: 'image/png' })],
                    title: 'Meu Palpite 77x Brasil',
                    text: 'Confira meu palpite para o jogo do bicho!'
                });
            } else {
                alert('Compartilhamento não suportado neste navegador. Por favor, baixe a imagem e compartilhe manualmente.');
            }
        }

        // Funções de Modal (reutilizadas do script.js, se existirem, ou definidas aqui)
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                document.body.classList.add('modal-open');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
            }
        }

        // Fechar modal ao clicar fora dele
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal') || event.target.classList.contains('image-modal')) {
                event.target.style.display = 'none';
            }
        });

        function copiarLegenda() {
            const dominio = window.location.origin;
            const codigo = getStoredProductCode() || '';
            
            // Montar URL dinamicamente baseado na existência do código
            let url;
            if (codigo) {
                url = `${dominio}?pr=${codigo}`;
            } else {
                url = dominio;
            }
            
            const texto = `Na 77x Brasil, faça a sua FÉZINHA com as melhores cotações, com direito à bônus exclusivos e sem taxa de saques.\nClique no link abaixo e saiba mais!\n${url}\n\n#jogodobichoonline\n#jogodobichofederal\n#jogodobicho\n#palpites\n#palpitesdodia`;

            navigator.clipboard.writeText(texto).then(() => {
                // Usar a função showToast() do script.js para exibir mensagem flutuante
                if (typeof showToast === 'function') {
                    showToast('✔️Legenda copiada para a área de transferência!');
                } else {
                    alert('✔️Legenda copiada para a área de transferência!');
                }
            }).catch(err => {
                console.error('Erro ao copiar legenda: ', err);
                // Usar a função showToast() do script.js para exibir mensagem de erro
                if (typeof showToast === 'function') {
                    showToast('Erro ao copiar a legenda.');
                } else {
                    alert('Erro ao copiar a legenda.');
                }
            });
        }

    </script>

    <footer class="site-footer">
        <div class="footer-content">
            <img src="/assets/img/logo.webp" alt="Logo do Site" class="footer-logo" loading="lazy">
            <p class="site-domain" id="siteDomain"></p>
            <p class="copyright-text" id="copyrightText"></p>
        </div>
    </footer>
</body>
</html>

